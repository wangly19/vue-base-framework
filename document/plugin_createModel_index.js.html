<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>JSDoc: Source: plugin/createModel/index.js</title>

        <script src="scripts/prettify/prettify.js"></script>
        <script src="scripts/prettify/lang-css.js"></script>
        <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
        <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
        <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
    </head>

    <body>

        <div class="page-content">

            <nav>
                <h3>Pages</h3><ul><li><a href="module-%25E6%25B5%258B%25E8%25AF%2595%25E9%25A1%25B5%25E9%259D%25A21.html">测试页面1</a></li><li><a href="module-%25E6%25B5%258B%25E8%25AF%2595%25E9%25A1%25B5%25E9%259D%25A22.html">测试页面2</a></li></ul><h3>Components</h3><ul><li><a href="module-SVG%25E5%259B%25BE%25E6%25A0%2587%25E7%25BB%2584%25E4%25BB%25B6.html">SVG图标组件</a></li></ul><h3>Classes</h3><ul><li><a href="CreateService.html">CreateService</a></li><li><a href="GenerateModel.html">GenerateModel</a></li></ul><h3>Global</h3><ul><li><a href="global.html#createHttpService">createHttpService</a></li><li><a href="global.html#getEnv">getEnv</a></li><li><a href="global.html#handleError">handleError</a></li><li><a href="global.html#promiseMiddleware">promiseMiddleware</a></li><li><a href="global.html#typeColor">typeColor</a></li><li><a href="global.html#useModels">useModels</a></li><li><a href="global.html#useServices">useServices</a></li></ul>
            </nav>

            <content>

                <div id="main">

                    <h1 class="page-title">Source: plugin/createModel/index.js</h1>

                    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @class GenerateModel
 */
class GenerateModel {
  /** * @constructor */
  constructor () {
    /** @property resultStock model列表 */
    this.resultStock = []
  }

  getCurrentModelFile () {
    const getAllRequireContextFile = requireContext =>
      requireContext.keys().map(requireContext)
    const modelFiles = require.context('@/views', true, /model.js$/)
    const modelStock = getAllRequireContextFile(modelFiles)
    this.resultStock = modelStock
  }

  createMixinQueue () {
    const mixinQueue = [{
      name: 'useDisaptch',
      mixin: {
        methods: {
          useDispatch: this.dispatch
        }
      }
    }]
    if (this.resultStock.length > 0) {
      this.resultStock.forEach(model => {
        const transformMethods = {}
        const transformLoadingEffect = {}
        const { namespace, state = {}, actions = {} } = model.default
        Object.keys(actions).forEach(fun => {
          transformMethods[`${namespace}/${fun}`] = actions[fun]
          transformLoadingEffect[`${namespace}/${fun}`] = false
        })
        mixinQueue.push({
          name: namespace,
          mixin: {
            data: () => ({
              model: { ...transformLoadingEffect },
              [namespace]: { ...state }
            }),
            methods: {
              ...transformMethods
            }
          }
        })
      })
    } else {
      this.warning('没有找到mdoel数据')
    }
    return mixinQueue
  }

  dispatch (modelCursor, payload) {
    const [namespace, actionName] = modelCursor.split('/')
    return new Promise((resolve, reject) => {
      this.$set(this.model, `${namespace}/${actionName}`, true)
      this[`${namespace}/${actionName}`](this[namespace], {
        payload,
        set: this.$set
      })
        .then(res => resolve(res))
        .catch(err => reject(err))
        .finally(() => {
          this.$set(this.model, `${namespace}/${actionName}`, false)
        })
    })
  }
}

const generateModel = new GenerateModel(['name'])
generateModel.getCurrentModelFile()
console.log(generateModel.createMixinQueue())
const currentModels = generateModel.createMixinQueue()

console.count()

export default currentModels
</code></pre>
        </article>
    </section>




                </div>
                <footer>
            Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Sun Dec 20 2020 22:53:52 GMT+0800 (中国标准时间)
                </footer>
            </content>

            <script>
                prettyPrint();
            </script>
            <script src="scripts/linenumber.js"></script>
        </body>
    </html>